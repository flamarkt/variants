{"version":3,"file":"forum.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDR,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFf,EAAyBM,IACH,oBAAXa,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeL,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeL,EAAS,aAAc,CAAEe,OAAO,GAAO,G,oDCL9D,MAAM,EAA+BC,OAAOC,KAAKC,OAAO,iBCAjD,IAAMC,EAAQ,CAAC,ECAtB,MAAM,EAA+BH,OAAOC,KAAKC,OAAO,4B,aCAxD,MAAM,IAAiCF,OAAOI,WAAW,kBAAkB,CAAC,GAAW,QAAG,CAAC,GAAG,kB,aCA9F,MAAM,IAAiCJ,OAAOI,WAAW,kBAAkB,CAAC,GAAU,OAAG,CAAC,GAAG,6B,aCA7F,MAAM,IAAiCJ,OAAOI,WAAW,kBAAkB,CAAC,GAAU,OAAG,CAAC,GAAG,8B,aCA7F,MAAM,IAAiCJ,OAAOI,WAAW,kBAAkB,CAAC,GAAW,QAAG,CAAC,GAAG,yB,aCA9F,MAAM,EAA+BJ,OAAOC,KAAKC,OAAO,gB,aCaxDG,IAAIC,aAAaC,IAAI,qBAAqB,WACtCC,IAAAA,UAAAA,SAA6BC,IAAAA,QAAc,aAE3CC,EAAAA,EAAAA,QAAOC,IAAAA,UAA6B,UAAU,WAC1CC,KAAKC,qBAAuB,CAC/B,KAEDC,EAAAA,EAAAA,UAASH,IAAAA,UAA6B,WAAW,SAAUI,GACvD,IAAOC,EAAWJ,KAAKK,MAAhBD,QAEP,IAAKA,IAAYA,EAAQE,UAAU,mBAC/B,OAAOH,IAGX,IAAMI,EAAWH,EAAQG,WAEnBC,EAAgBC,MAAMC,QAAQH,GAAYA,EAASI,OAAS,EAElE,OAAIX,KAAKC,qBAAuBO,EAAgB,EACrC,KAGJD,EAASP,KAAKC,qBACxB,KAEDH,EAAAA,EAAAA,QAAOC,IAAAA,UAA6B,gBAAgB,SAAUa,GAAO,WAE3DC,EAAgBb,KAAKK,MAAMD,QAEjC,GAAKS,EAAcP,UAAU,mBAA7B,CAIA,IAAMC,EAAWM,EAAcN,WAE/B,GAAKE,MAAMC,QAAQH,GAAnB,CAIA,IAAMO,EAAe,CAAC,EAEtBP,EAASQ,SAAQ,SAAAC,GACbF,EAAQE,EAAQC,MAAQD,EAAQE,OACnC,IAEDN,EAAMjB,IAAI,WAAYwB,IAAAA,UAAiB,CACnChC,MAAOoB,EAASP,KAAKC,sBAAsBgB,KAC3CH,QAAAA,EACAM,SAAU,SAACH,GACP,EAAKhB,qBAAuBM,EAASc,WAAU,SAAAL,GAAO,OAAIA,EAAQC,OAASA,CAArB,GACzD,IACD,GAdH,CANA,CAqBJ,KAEDnB,EAAAA,EAAAA,QAAOwB,IAAAA,UAA2B,SAAS,SAAUV,GACjD,IAAOR,EAAWJ,KAAKK,MAAhBD,QAEP,GAAKA,EAAQE,UAAU,mBAAvB,CAIA,IAAMC,EAAWH,EAAQG,WAEzB,GAAKE,MAAMC,QAAQH,MAAaA,EAASI,OAAS,GAAlD,CAIA,IAAIY,EAA0B,KAC1BC,EAA0B,KAE9BjB,EAASQ,SAAQ,SAAAC,GACb,IAAM7B,EAAQ6B,EAAQS,QAEjBtC,KAIY,OAAboC,GAAqBpC,EAAQoC,KAC7BA,EAAWpC,IAGE,OAAbqC,GAAqBrC,EAAQqC,KAC7BA,EAAWrC,GAElB,IAKgB,OAAboC,GAAqBA,IAAaC,GAItCZ,EAAMc,QAAQ,QAASC,EAAE,8BAA+B,CACpDA,EAAEC,IAAY,CACVzC,MAAOoC,IAEX,MACAI,EAAEC,IAAY,CACVzC,MAAOqC,MAlCd,CANA,CA2CJ,GACJ,G","sources":["webpack://@flamarkt/variants/webpack/bootstrap","webpack://@flamarkt/variants/webpack/runtime/compat get default export","webpack://@flamarkt/variants/webpack/runtime/define property getters","webpack://@flamarkt/variants/webpack/runtime/hasOwnProperty shorthand","webpack://@flamarkt/variants/webpack/runtime/make namespace object","webpack://@flamarkt/variants/external root \"flarum.core.compat['common/extend']\"","webpack://@flamarkt/variants/./src/forum/compat.ts","webpack://@flamarkt/variants/external root \"flarum.core.compat['common/components/Select']\"","webpack://@flamarkt/variants/external root \"((flarum.extensions['flamarkt-core']||{})['common']||{})['models/Product']\"","webpack://@flamarkt/variants/external root \"((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/ProductShowLayout']\"","webpack://@flamarkt/variants/external root \"((flarum.extensions['flamarkt-core']||{})['forum']||{})['components/ProductListItem']\"","webpack://@flamarkt/variants/external root \"((flarum.extensions['flamarkt-core']||{})['common']||{})['components/PriceLabel']\"","webpack://@flamarkt/variants/external root \"flarum.core.compat['common/Model']\"","webpack://@flamarkt/variants/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","export const forum = {\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Select'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['common']||{})['models/Product'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/ProductShowLayout'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['forum']||{})['components/ProductListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['common']||{})['components/PriceLabel'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import {extend, override} from 'flarum/common/extend';\nimport {forum} from './compat';\nimport Select from 'flarum/common/components/Select';\nimport Product from 'flamarkt/core/common/models/Product';\nimport ProductShowLayout from 'flamarkt/core/forum/layouts/ProductShowLayout';\nimport ProductListItem from 'flamarkt/core/forum/components/ProductListItem';\nimport PriceLabel from 'flamarkt/core/common/components/PriceLabel';\nimport Model from 'flarum/common/Model';\n\nexport {\n    forum,\n};\n\napp.initializers.add('flamarkt-variants', () => {\n    Product.prototype.variants = Model.hasMany('variants');\n\n    extend(ProductShowLayout.prototype, 'oninit', function () {\n        this.selectedVariantIndex = 0;\n    });\n\n    override(ProductShowLayout.prototype, 'product', function (original: any) {\n        const {product} = this.attrs;\n\n        if (!product || !product.attribute('isVariantMaster')) {\n            return original();\n        }\n\n        const variants = product.variants();\n\n        const variantsCount = Array.isArray(variants) ? variants.length : 0;\n\n        if (this.selectedVariantIndex > variantsCount - 1) {\n            return null;\n        }\n\n        return variants[this.selectedVariantIndex];\n    });\n\n    extend(ProductShowLayout.prototype, 'priceSection', function (items) {\n        // We need to access the base attr and not use the function parameter because the parameter has already been switched to a variant\n        const masterProduct = this.attrs.product!;\n\n        if (!masterProduct.attribute('isVariantMaster')) {\n            return;\n        }\n\n        const variants = masterProduct.variants();\n\n        if (!Array.isArray(variants)) {\n            return;\n        }\n\n        const options: any = {};\n\n        variants.forEach(variant => {\n            options[variant.id()] = variant.title();\n        });\n\n        items.add('variants', Select.component({\n            value: variants[this.selectedVariantIndex].id(),\n            options,\n            onchange: (id: string) => {\n                this.selectedVariantIndex = variants.findIndex(variant => variant.id() === id);\n            },\n        }), 60);\n    });\n\n    extend(ProductListItem.prototype, 'items', function (items) {\n        const {product} = this.attrs;\n\n        if (!product.attribute('isVariantMaster')) {\n            return;\n        }\n\n        const variants = product.variants();\n\n        if (!Array.isArray(variants) || variants.length < 2) {\n            return;\n        }\n\n        let minPrice: number | null = null;\n        let maxPrice: number | null = null;\n\n        variants.forEach(variant => {\n            const value = variant.price();\n\n            if (!value) {\n                return;\n            }\n\n            if (minPrice === null || value < minPrice) {\n                minPrice = value;\n            }\n\n            if (maxPrice === null || value > maxPrice) {\n                maxPrice = value;\n            }\n        });\n\n        // If there wasn't a single valid price, minPrice will be null\n        // If the min anx max prices are same, no need to do anything\n        // TODO: still if the price is the same, the parent might not have any price\n        if (minPrice === null || minPrice === maxPrice) {\n            return;\n        }\n\n        items.replace('price', m('span.ProductListItem--price', [\n            m(PriceLabel, {\n                value: minPrice,\n            }),\n            ' - ',\n            m(PriceLabel, {\n                value: maxPrice,\n            }),\n        ]))\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","forum","extensions","app","initializers","add","Product","Model","extend","ProductShowLayout","this","selectedVariantIndex","override","original","product","attrs","attribute","variants","variantsCount","Array","isArray","length","items","masterProduct","options","forEach","variant","id","title","Select","onchange","findIndex","ProductListItem","minPrice","maxPrice","price","replace","m","PriceLabel"],"sourceRoot":""}